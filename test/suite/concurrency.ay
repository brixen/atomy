test(concurrency)

atomy/describe("concurrency"):
  atomy/describe("spawn"):
    atomy/it("creates an actor that executes a block"):
      a = 0
      atomy/spawn: a =! 1
      sleep(0.1)
      a should-be(1)


  atomy/describe("<-"):
    atomy/it("sends a message to an actor"):
      main = me
      p = atomy/spawn:
        receive: n -> main << #ok;
          after(
            1 -> main <- #timeout-inner
          )

      p <- 0

      res =
        receive: x -> x;
          after(2 -> #timeout-outer)

      res should-be(#ok)
