#!/usr/bin/env rbx

base = File.expand_path "../../lib/", __FILE__
kernel = File.expand_path "../../kernel/", __FILE__

require 'readline'

require base + "/macros"
require base + "/method"
require base + "/util"
require base + "/compiler/compiler"
require base + "/compiler/stages"
require base + "/parser"
require base + "/patterns"
require base + "/code_loader"

bnd = TOPLEVEL_BINDING

def require_atomy(*as)
  Atomy::CodeLoader.load_file *as
end

a = Time.now
puts "loading kernel"
require_atomy(kernel + "/boot.ay")
puts Time.now - a

if ARGV[0]
  require_atomy(ARGV[0])
  exit(0)
end

repl(File.expand_path("~/.atomy_history"))
